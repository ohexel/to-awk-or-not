
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="canonical" href="https://pmitev.github.io/to-awk-or-not/Bio/NCBI-taxonomy/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.6">
    
    
      
        <title>Substitute scientific with common species names in a phylogenetic tree file - To awk or not</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.802231af.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
      <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#substitute-scientific-with-common-species-names-in-a-phylogenetic-tree-file" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="To awk or not" class="md-header__button md-logo" aria-label="To awk or not" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            To awk or not
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Substitute scientific with common species names in a phylogenetic tree file
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 10a2 2 0 0 1 2 2 2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2m10-3a5 5 0 0 1 5 5 5 5 0 0 1-5 5H7a5 5 0 0 1-5-5 5 5 0 0 1 5-5h10M7 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3h10a3 3 0 0 0 3-3 3 3 0 0 0-3-3H7z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/pmitev/to-awk-or-not/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="To awk or not" class="md-nav__button md-logo" aria-label="To awk or not" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    To awk or not
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/pmitev/to-awk-or-not/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../1.Simple_example/" class="md-nav__link">
        1.Simple examples
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../2.Teasing_with_grep/" class="md-nav__link">
        2.Teasing with grep
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../3.Shell_we_awk/" class="md-nav__link">
        3.Shell we awk
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../4.Brief_commands/" class="md-nav__link">
        4.Brief commands
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../5.String_manipulation/" class="md-nav__link">
        5.String manipulation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../6.One_line_programs/" class="md-nav__link">
        6.One line programs
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Python_vs_awk/" class="md-nav__link">
        Python vs. awk
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      <label class="md-nav__link" for="__nav_9">
        Exercises
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Exercises" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Exercises
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Exercises/Exercises/" class="md-nav__link">
        Warming up
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Exercises/01.Simple_arithmetic/" class="md-nav__link">
        01.Simple arithmetic *
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Exercises/02.Data_extraction/" class="md-nav__link">
        02.Data extraction *
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Exercises/03.Data_extraction/" class="md-nav__link">
        03.Data extraction **
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Exercises/04.Data_manipulation/" class="md-nav__link">
        04.Data manipulation **
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Exercises/05.Easy_tricks/" class="md-nav__link">
        05.Easy tricks *
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Exercises/06.Bioinformaticians_corner/" class="md-nav__link">
        06.Bioinformaticians corner *
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Exercises/Advanced_data_analysis/" class="md-nav__link">
        Advanced data analysis ****
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Exercises/Carpool/" class="md-nav__link">
        Carpool ***
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Exercises/Difficult_data/" class="md-nav__link">
        Difficult to extract data ****
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Exercises/Scrubbing/" class="md-nav__link">
        Scrubbing a web page **
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Exercises/String_manipulation/" class="md-nav__link">
        String manipulation **
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Exercises/awk-json/" class="md-nav__link">
        Awk and json **
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Exercises/Linear_regression/" class="md-nav__link">
        Simple linear regresion ***
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Case_studies/List/" class="md-nav__link">
        = Case Studies =
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_11" type="checkbox" id="__nav_11" >
      
      <label class="md-nav__link" for="__nav_11">
        More with awk
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="More with awk" data-md-level="1">
        <label class="md-nav__title" for="__nav_11">
          <span class="md-nav__icon md-icon"></span>
          More with awk
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../More_awk/User_defined_functions/" class="md-nav__link">
        User defined functions
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../More_awk/Command_params/" class="md-nav__link">
        Parameters on the command line
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../More_awk/Input_output/" class="md-nav__link">
        Input/Output to external program
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../More_awk/Running_average/" class="md-nav__link">
        Running averages
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Other/Fixed_size_fields/" class="md-nav__link">
        Fixed size fields
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Other/Backreferences/" class="md-nav__link">
        Backreferences
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://www.gnu.org/software/gawk/manual/html_node/Multiple-Line.html" class="md-nav__link">
        Multi-Line records
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../arrays/" class="md-nav__link">
        Awk arrays
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../awk_bash/" class="md-nav__link">
        Awk or Bash
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Other/Localization/" class="md-nav__link">
        Localization problems
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="http://www.thegeekstuff.com/2011/06/awk-nawk-gawk/" class="md-nav__link">
        Awk vs. nawk vs. gawk
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Other/Binder/" class="md-nav__link">
        GitHub & Binder
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../handy/" class="md-nav__link">
        Handy to have
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../tinyutils/" class="md-nav__link">
        tinyutils
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Links/" class="md-nav__link">
        Links
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../About/" class="md-nav__link">
        About
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-generate-a-table-with-the-scientific-common-name-correspondence" class="md-nav__link">
    Step 1 - Generate a table with the scientific-common name correspondence
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-edit-the-phylogenetic-tree-file" class="md-nav__link">
    Step 2 - Edit the phylogenetic tree file
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-1" class="md-nav__link">
    Step 1
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2" class="md-nav__link">
    Step 2
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/pmitev/to-awk-or-not/edit/master/docs/Bio/NCBI-taxonomy.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="substitute-scientific-with-common-species-names-in-a-phylogenetic-tree-file">Substitute scientific with common species names in a phylogenetic tree file</h1>
<blockquote>
<p>Problem formulated an presented at the workshop by <a href="https://katalog.uu.se/empinfo/?id=N12-828"><strong>Voichita Marinescu</strong></a>, Department of Medical Biochemistry and Microbiology, <em>Comparative genetics and functional genomics</em></p>
</blockquote>
<h3 id="step-1-generate-a-table-with-the-scientific-common-name-correspondence">Step 1 - Generate a table with the scientific-common name correspondence</h3>
<p>We need the correspondence between the scientific and common species names as described in the <a href="https://www.ncbi.nlm.nih.gov/Taxonomy/Browser/wwwtax.cgi?mode=Info&amp;id=10090&amp;lvl=2&amp;p=has_linkout&amp;p=blast_url&amp;p=genome_blast&amp;lin=f&amp;keep=1&amp;srchmode=1&amp;unlock">NCBI Taxonomy Database</a>.</p>
<p>We want to do this for any number of species automatically, so we download the entire archive taxdump.tar.gz from the <a href="ftp://ftp.ncbi.nlm.nih.gov/pub/taxonomy/">NCBI taxonomy database dump</a>.</p>
<p>This archive contains the <code>names.dmp</code> file with the format:
<div class="highlight"><pre><span></span><code>10090   |   house mouse |       |   genbank common name |
10090   |   LK3 transgenic mice |       |   includes    |
10090   |   mouse   |   mouse &lt;Mus musculus&gt;    |   common name |
10090   |   Mus musculus Linnaeus, 1758 |       |   authority   |
10090   |   Mus musculus    |       |   scientific name |
10090   |   Mus sp. 129SV   |       |   includes    |
10090   |   nude mice   |       |   includes    |
10090   |   transgenic mice |       |   includes    |
</code></pre></div></p>
<p>Make new folder for this exercise and <code>cd</code> into it. Download the file and extract the <code>names.dmp</code></p>
<div class="highlight"><pre><span></span><code>$ wget ftp://ftp.ncbi.nlm.nih.gov/pub/taxonomy/taxdump.tar.gz
$ tar -xvf taxdump.tar.gz names.dmp
</code></pre></div>
<div class="highlight"><pre><span></span><code>taxdump.tar.gz    51MB
names.dmp        189MB 
</code></pre></div>
<ul>
<li>We want to convert this table into a tab delimited file with this format:
<div class="highlight"><pre><span></span><code>taxonID    scientific_name    common_name    genbank_common_name
10090      Mus musculus       mouse          house mouse
</code></pre></div></li>
<li>We want to add an underscore between the genus (e.g. Mus) and the specific name of the species (e.g. musculus), so the scientific name is listed as in the tree file (e.g Mus_musculus).</li>
<li>We want to capitalize the first word in the common name (if not already capitalized).</li>
</ul>
<h3 id="step-2-edit-the-phylogenetic-tree-file">Step 2 - Edit the phylogenetic tree file</h3>
<p>The phylogenetic tree file used for the 100way alignment is hg38.100way.scientificNames.nh. 
It can be downloaded from <a href="http://hgdownload.cse.ucsc.edu/goldenpath/hg38/multiz100way/">here</a> and details could be found <a href="http://genomewiki.ucsc.edu/index.php/Phylogenetic_Tree">here</a>.</p>
<p>Download the file (4.1KB).
<div class="highlight"><pre><span></span><code>$ wget http://hgdownload.cse.ucsc.edu/goldenpath/hg38/multiz100way/hg38.100way.scientificNames.nh
</code></pre></div></p>
<p>The format of the tree file is
<div class="highlight"><pre><span></span><code>    ((((((((((((((((((Homo_sapiens:0.00655,
                 Pan_troglodytes:0.00684):0.00422,
                Gorilla_gorilla_gorilla:0.008964):0.009693,
               Pongo_pygmaeus_abelii:0.01894):0.003471,
              Nomascus_leucogenys:0.02227):0.01204,
             (((Macaca_mulatta:0.004991,
               Macaca_fascicularis:0.004991):0.003,
              Papio_anubis:0.008042):0.01061,
             Chlorocebus_sabaeus:0.027):0.025):0.02183,
            (Callithrix_jacchus:0.03,
            Saimiri_boliviensis:0.01035):0.01965):0.07261,
           Otolemur_garnettii:0.13992):0.013494,
          Tupaia_chinensis:0.174937):0.002,
         (((Spermophilus_tridecemlineatus:0.125468,
</code></pre></div></p>
<p>See a description of the Newick tree format <a href="https://en.wikipedia.org/wiki/Newick_format">here</a>.</p>
<p>The phylogenetic tree could be visualized online at <a href="https://itol.embl.de/">https://itol.embl.de/</a> (notice that this application takes care of removing the _ from the scientific name).</p>
<p><img alt="" src="../../images/1t.png" /></p>
<p><strong>Before</strong></p>
<p><img alt="" src="../../images/1tb.png" /></p>
<p><strong>After</strong></p>
<p><img alt="" src="../../images/2tb.png" /></p>
<hr />
<h3 id="step-1">Step 1</h3>
<p><img alt="⚠" class="twemoji" src="https://twemoji.maxcdn.com/v/latest/svg/26a0.svg" title=":warning:" /> <strong>!!! WARNING !!! WARNING !!! WARNING !!!</strong> <img alt="⚠" class="twemoji" src="https://twemoji.maxcdn.com/v/latest/svg/26a0.svg" title=":warning:" /></p>
<p>The files are in Windows/DOS <code>ASCII text, with CRLF line terminators</code> format which makes awk to misbehave. Check your files and convert them to UNIX format if necessary.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># check the format</span>
$ file filename
filename: ASCII text, with CRLF line terminators

<span class="c1"># Convert to unix format</span>
$ dos2unix filename
dos2unix: converting file filename to Unix format ...

<span class="c1"># check again</span>
$ file filename
filename: ASCII text
</code></pre></div>
<p>Let's first tabulate the <em>NCBI Taxonomy Database</em> in more convenient format for us - getting the relevant information on single line, replace some spaces with underscore symbol <code>_</code>, remove the extra blanks in front and after the names, etc.</p>
<div class="admonition example">
<p class="admonition-title">names.tab</p>
<div class="highlight"><pre><span></span><code>9605|Homo|Humans|
9606|Homo_sapiens|Man|
9608|Canidae|Dog, coyote, wolf, fox|
9611|Canis||
9612|Canis_lupus|Grey wolf|
9614|Canis_latrans|Coyote|
9615|Canis_lupus_familiaris|Dogs|
9616|Canis_sp.||
9619|Dusicyon||
9620|Cerdocyon_thous|Crab-eating fox|
9621|Lycaon||
9622|Lycaon_pictus|Painted hunting dog|
9623|Otocyon||
9624|Otocyon_megalotis|Bat-eared fox|
9625|Vulpes||
9626|Vulpes_chama|Cape fox|
9627|Vulpes_vulpes|Silver fox|
9629|Vulpes_corsac|Corsac fox|
9630|Vulpes_macrotis|Kit fox|
9631|Vulpes_velox|Swift fox|
</code></pre></div>
</div>
<p>Might not be the best solution but it is easy to read and modify, for now. Note, we do not need to sort but it will look better if we have the final result in order.</p>
<div class="highlight"><pre><span></span><code>$ ./01.tabulate-names.awk names.dmp <span class="p">|</span> sort -g -k <span class="m">1</span> &gt; names.tab

<span class="c1"># Or with bzip2 compression &quot;on the fly&quot;</span>
$ ./01.tabulate-names.awk &lt;<span class="o">(</span>bzcat names.dmp.bz2<span class="o">)</span> <span class="p">|</span> bzip2 -c &gt; names.tab.bz2
</code></pre></div>
<details class="note"><summary>01.tabulate-names.awk</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1">#!/usr/bin/awk -f</span>
<span class="nb">BEGIN</span><span class="p">{</span>
  <span class="nb">FS</span><span class="o">=</span><span class="s2">&quot;|&quot;</span>
<span class="c1">#  print &quot;#taxonID scientific_name        common_name     genbank_common_name&quot;</span>
<span class="p">}</span>

<span class="o">$</span><span class="mi">4</span> <span class="o">~</span> <span class="s2">&quot;scientific name&quot;</span>     <span class="p">{</span> <span class="nx">sciname</span><span class="p">[</span><span class="o">$</span><span class="mi">1</span><span class="o">*</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span>  <span class="nx">unds</span><span class="p">(</span><span class="nx">Clean</span><span class="p">(</span><span class="o">$</span><span class="mi">2</span><span class="p">));</span> <span class="kr">next</span><span class="p">}</span>

<span class="o">$</span><span class="mi">4</span> <span class="o">~</span> <span class="s2">&quot;common name&quot;</span>         <span class="p">{</span> <span class="nx">com_name</span><span class="p">[</span><span class="o">$</span><span class="mi">1</span><span class="o">*</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span> <span class="nx">Cap</span><span class="p">(</span><span class="nx">Clean</span><span class="p">(</span><span class="o">$</span><span class="mi">2</span><span class="p">));</span>  <span class="kr">next</span><span class="p">}</span>

<span class="o">$</span><span class="mi">4</span> <span class="o">~</span> <span class="s2">&quot;genbank common name&quot;</span> <span class="p">{</span> <span class="nx">genbank</span><span class="p">[</span><span class="o">$</span><span class="mi">1</span><span class="o">*</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span>  <span class="nx">unds</span><span class="p">(</span><span class="nx">Clean</span><span class="p">(</span><span class="o">$</span><span class="mi">2</span><span class="p">));</span> <span class="kr">next</span><span class="p">}</span>

<span class="nb">END</span><span class="p">{</span>
  <span class="k">for</span><span class="p">(</span><span class="nx">i</span> <span class="o">in</span> <span class="nx">sciname</span><span class="p">)</span> <span class="kr">print</span> <span class="nx">i</span><span class="s2">&quot;|&quot;</span><span class="nx">sciname</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="s2">&quot;|&quot;</span><span class="nx">com_name</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="s2">&quot;|&quot;</span><span class="nx">genbank</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
<span class="p">}</span>

<span class="c1"># Function declarations ==============================</span>

<span class="kd">function</span> <span class="nx">Clean</span> <span class="p">(</span><span class="nx">string</span><span class="p">){</span>
  <span class="kr">sub</span><span class="p">(</span><span class="sr">/^[ \t]+/</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span><span class="nx">string</span><span class="p">)</span>
  <span class="kr">sub</span><span class="p">(</span><span class="sr">/[ \t]+$/</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span><span class="nx">string</span><span class="p">)</span>
  <span class="k">return</span> <span class="nx">string</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">unds</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="p">{</span> <span class="kr">gsub</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;_&quot;</span><span class="p">,</span><span class="nx">string</span><span class="p">);</span> <span class="k">return</span> <span class="nx">string</span><span class="p">}</span>

<span class="kd">function</span> <span class="nx">Cap</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="kr">toupper</span><span class="p">(</span><span class="kr">substr</span><span class="p">(</span><span class="nx">string</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="kr">substr</span><span class="p">(</span><span class="nx">string</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="p">}</span>
</code></pre></div>
</td></tr></table>
</details>
<p>Note that this script will keep the last information for the corresponding match for each ID. To prevent this we need to take care that any subsequent match is ignored</p>
<details class="note"><summary>01.tabulate-names-first.awk</summary><div class="highlight"><pre><span></span><code><span class="c1">#!/usr/bin/awk -f</span>
<span class="nb">BEGIN</span><span class="p">{</span>
  <span class="nb">FS</span><span class="o">=</span><span class="s2">&quot;|&quot;</span>
<span class="c1">#  print &quot;#taxonID scientific_name        common_name     genbank_common_name&quot;</span>
<span class="p">}</span>

<span class="o">$</span><span class="mi">4</span> <span class="o">~</span> <span class="s2">&quot;scientific name&quot;</span>     <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">sciname</span><span class="p">[</span><span class="o">$</span><span class="mi">1</span><span class="o">*</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="nx">sciname</span><span class="p">[</span><span class="o">$</span><span class="mi">1</span><span class="o">*</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span>  <span class="nx">unds</span><span class="p">(</span><span class="nx">Clean</span><span class="p">(</span><span class="o">$</span><span class="mi">2</span><span class="p">));</span> <span class="kr">next</span><span class="p">}</span>

<span class="o">$</span><span class="mi">4</span> <span class="o">~</span> <span class="s2">&quot;common name&quot;</span>         <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">com_name</span><span class="p">[</span><span class="o">$</span><span class="mi">1</span><span class="o">*</span><span class="mi">1</span><span class="p">])</span> <span class="nx">com_name</span><span class="p">[</span><span class="o">$</span><span class="mi">1</span><span class="o">*</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span> <span class="nx">Cap</span><span class="p">(</span><span class="nx">Clean</span><span class="p">(</span><span class="o">$</span><span class="mi">2</span><span class="p">));</span>  <span class="kr">next</span><span class="p">}</span>

<span class="o">$</span><span class="mi">4</span> <span class="o">~</span> <span class="s2">&quot;genbank common name&quot;</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">genbank</span><span class="p">[</span><span class="o">$</span><span class="mi">1</span><span class="o">*</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="nx">genbank</span><span class="p">[</span><span class="o">$</span><span class="mi">1</span><span class="o">*</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span>  <span class="nx">unds</span><span class="p">(</span><span class="nx">Clean</span><span class="p">(</span><span class="o">$</span><span class="mi">2</span><span class="p">));</span> <span class="kr">next</span><span class="p">}</span>

<span class="nb">END</span><span class="p">{</span>
  <span class="k">for</span><span class="p">(</span><span class="nx">i</span> <span class="o">in</span> <span class="nx">sciname</span><span class="p">)</span> <span class="kr">print</span> <span class="nx">i</span><span class="s2">&quot;|&quot;</span><span class="nx">sciname</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="s2">&quot;|&quot;</span><span class="nx">com_name</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="s2">&quot;|&quot;</span><span class="nx">genbank</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">Clean</span> <span class="p">(</span><span class="nx">string</span><span class="p">){</span>
  <span class="kr">sub</span><span class="p">(</span><span class="sr">/^[ \t]+/</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span><span class="nx">string</span><span class="p">)</span>
  <span class="kr">sub</span><span class="p">(</span><span class="sr">/[ \t]+$/</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span><span class="nx">string</span><span class="p">)</span>
  <span class="k">return</span> <span class="nx">string</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">unds</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="p">{</span> <span class="kr">gsub</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;_&quot;</span><span class="p">,</span><span class="nx">string</span><span class="p">);</span> <span class="k">return</span> <span class="nx">string</span><span class="p">}</span>

<span class="kd">function</span> <span class="nx">Cap</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="kr">toupper</span><span class="p">(</span><span class="kr">substr</span><span class="p">(</span><span class="nx">string</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="kr">substr</span><span class="p">(</span><span class="nx">string</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="p">}</span>
</code></pre></div>
</details>
<hr />
<h3 id="step-2">Step 2</h3>
<p>Now we can use the tabulated data in <code>names.tab</code> and perform the replacement in <code>hg38.100way.scientificNames.nh</code> by matching the scientific names in <code>$2</code> with the common names in <code>$3</code> - we use <code>FS="|"</code></p>
<div class="highlight"><pre><span></span><code>((((((((((((((((((Man:0.00655,
                 Chimpanzee:0.00684):0.00422,
                Western lowland gorilla:0.008964):0.009693,
               Pongo_pygmaeus_abelii:0.01894):0.003471,
              White-cheeked Gibbon:0.02227):0.01204,
             (((Rhesus monkeys:0.004991,
               Long-tailed macaque:0.004991):0.003,
              Olive baboon:0.008042):0.01061,
             Green monkey:0.027):0.025):0.02183,
            (White-tufted-ear marmoset:0.03,
            Bolivian squirrel monkey:0.01035):0.01965):0.07261,
           Small-eared galago:0.13992):0.013494,
</code></pre></div>
<p>Again, this might not be the best way but it works. The suggested solutions could be easily merged into a single script. I would prefer to have them in steps, so I can make sure that the first step has completed successfully (<em>it takes some time</em>) before I continue. Also I can filter the unnecessary data in the newly tabulated file and use only relevant data or alter further if I need. </p>
<div class="highlight"><pre><span></span><code>$ ./02.substitute.awk  names.tab  hg38.100way.scientificNames.nh &gt; NEW.g38.100way.scientificNames.nh

<span class="c1"># Or with bzip2 compression &quot;on the fly&quot;</span>
$ ./02.substitute.awk &lt;<span class="o">(</span>bzcat names.tab.bz2<span class="o">)</span> hg38.100way.scientificNames.nh &gt; NEW.g38.100way.scientificNames.nh
</code></pre></div>
<div class="highlight"><pre><span></span><code>$ ./02.substitute.awk names.tab hg38.100way.scientificNames.nh
</code></pre></div>
<details class="note"><summary>02.substitute.awk</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1">#!/usr/bin/awk -f</span>
<span class="nb">BEGIN</span><span class="p">{</span>
  <span class="nb">FS</span><span class="o">=</span><span class="s2">&quot;|&quot;</span>
<span class="c1">#  print &quot;#taxonID scientific_name        common_name     genbank_common_name&quot;</span>
<span class="p">}</span>

<span class="nb">NR</span><span class="o">==</span> <span class="nb">FNR</span><span class="p">{</span> <span class="nx">map</span><span class="p">[</span><span class="o">$</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span> <span class="o">$</span><span class="mi">3</span><span class="p">;</span> <span class="kr">next</span><span class="p">}</span>

<span class="p">{</span>
  <span class="nx">line</span><span class="o">=</span> <span class="o">$</span><span class="mi">0</span>
  <span class="kr">gsub</span><span class="p">(</span><span class="s2">&quot;[0-9.,;:)( ]&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span> <span class="o">$</span><span class="mi">0</span> <span class="o">in</span> <span class="nx">map</span><span class="p">)</span> <span class="kr">sub</span><span class="p">(</span><span class="o">$</span><span class="mi">0</span><span class="p">,</span><span class="nx">map</span><span class="p">[</span><span class="o">$</span><span class="mi">0</span><span class="p">],</span><span class="nx">line</span><span class="p">)</span>
  <span class="kr">print</span> <span class="nx">line</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
</details>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      <a href="https://uppmax.uu.se/" target="_blank" rel="noopener"><img align="right" alt="Uppsala" src="https://pmitev.github.io/to-awk-or-not/images/Uppsala.png" /> </a>
      <a href="https://snic.se/" target="_blank" rel="noopener"><img align="right" alt="SNIC" src="https://pmitev.github.io/to-awk-or-not/images/SNIC.png" /> </a>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.409db549.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.756773cc.min.js"></script>
      
        <script src="../../javascripts/config.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>